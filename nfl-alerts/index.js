require('dotenv').config();\nconst axios = require('axios');\nconst { exec } = require('child_process');\nconst cron = require('node-cron');\n\n// State: track last scores per game {eventId: {homeScore, awayScore}}\nlet lastScores = {};\nconst CHAT_ID = process.env.CHAT_ID || '468765386';\nconst CHANNEL = process.env.TELEGRAM_CHANNEL || 'telegram';\n\nasync function fetchNFLScoreboard() {\n  try {\n    const res = await axios.get('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard?seasontype=2&seasontype=3&limit=100');\n    return res.data;\n  } catch (e) {\n    console.error('Scoreboard fetch failed:', e.message);\n    return null;\n  }\n}\n\nfunction sendAlert(message) {\n  const cmd = `openclaw message send --channel ${CHANNEL} --target ${CHAT_ID} --message \"${message.replace(/\"/g, '\\\\\"')}\"`;\n  exec(cmd, (err) => {\n    if (err) console.error('Alert send failed:', err);\n    else console.log('Alert sent:', message);\n  });\n}\n\nfunction checkScoreChanges(events) {\n  events?.forEach(event => {\n    if (event.status.type.state !== 'in') return; // Live only\n\n    const id = event.id;\n    const home = event.competitions[0].competitors[0];\n    const away = event.competitions[0].competitors[1];\n    const homeTeam = home.team.displayName;\n    const awayTeam = away.team.displayName;\n    const homeScore = parseInt(home.score || '0');\n    const awayScore = parseInt(away.score || '0');\n    const quarter = event.status.type.shortDetail || 'Live';\n    const clock = event.status.displayClock || '';\n\n    const current = { homeScore, awayScore };\n    const prev = lastScores[id];\n\n    if (prev && (prev.homeScore !== homeScore || prev.awayScore !== awayScore)) {\n      const scorer = homeScore > prev.homeScore ? homeTeam : awayTeam;\n      const points = Math.abs((homeScore + awayScore) - (prev.homeScore + prev.awayScore));\n      sendAlert(`**${awayTeam} ${awayScore}-${homeScore} ${homeTeam}** (${quarter}${clock ? ` ${clock}` : ''}) â€“ ${scorer} scores ${points} pts! ðŸˆ`);\n    }\n\n    lastScores[id] = current;\n  });\n}\n\nasync function pollScores() {\n  console.log('Polling NFL...');\n  const data = await fetchNFLScoreboard();\n  if (data?.events) {\n    checkScoreChanges(data.events);\n    // Cleanup old games\n    Object.keys(lastScores).forEach(id => {\n      if (!data.events.find(e => e.id === id)) delete lastScores[id];\n    });\n  }\n}\n\n// Poll every 30s during potential game times (US prime time), else 5min\ncron.schedule('*/30 * * * *', pollScores); // Aggressive during day\ncron.schedule('0 */5 * * *', pollScores); // Fallback\n\n// Express server for webhook/health (Cloudflare public)\nconst express = require('express');\nconst app = express();\napp.use(express.json());\n\napp.get('/health', (req, res) => res.json({ status: 'ok', lastPoll: new Date().toISOString() }));\napp.get('/scores', async (req, res) => {\n  const data = await fetchNFLScoreboard();\n  res.json({ liveGames: data?.events?.filter(e => e.status.type.state === 'in') || [], tracked: Object.keys(lastScores) });\n});\n\napp.post('/webhook', (req, res) => {\n  console.log('External webhook received:', req.body);\n  // Future: process external pushes\n  res.json({ received: true });\n});\n\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () => console.log(`NFL Alerts running on port ${PORT}. Public via Cloudflare tunnel.`));\n\npollScores(); // Initial poll\n\n// Graceful shutdown\nprocess.on('SIGINT', () => {\n  console.log('Shutting down...');\n  process.exit();\n});\n