const http = require('http');\nconst { exec } = require('child_process');\nconst fetch = require('node-fetch'); // Native in Node 22\n\nlet lastScores = {};\nconst CHAT_ID = '468765386';\nconst TARGET_GAME = 'Super Bowl';\nlet gameEnded = false;\n\nasync function fetchScoreboard() {\n  try {\n    const res = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard?seasontype=3&dates=20260209');\n    return await res.json();\n  } catch (e) {\n    console.error('Fetch failed:', e);\n    return null;\n  }\n}\n\nfunction sendAlert(message) {\n  const cmd = `openclaw message action=send channel=telegram target=${CHAT_ID} message="${message.replace(/\\\"/g, '\\\\\"').replace(/\\$/g, '\\\\$')}"`;\n  exec(cmd, (err) => {\n    if (err) console.error('Alert failed:', err);\n    else console.log('Alert sent:', message);\n  });\n}\n\nfunction checkChanges(event) {\n  if (gameEnded || event.status.type.state !== 'in') {\n    if (lastScores[event.id] && event.status.type.state !== 'in') {\n      const home = event.competitions[0].competitors[0];\n      const away = event.competitions[0].competitors[1];\n      sendAlert(`ðŸˆ **${TARGET_GAME} FINAL:** ${away.team.displayName} ${away.score || 0} - ${home.team.displayName} ${home.score || 0}`);\n      gameEnded = true;\n    }\n    return;\n  }\n\n  const id = event.id;\n  const comp = event.competitions[0];\n  const away = comp.competitors[1];\n  const home = comp.competitors[0];\n  const awayScore = parseInt(away.score || '0');\n  const homeScore = parseInt(home.score || '0');\n  const quarter = event.status.type.shortDetail || 'Live';\n  const clock = event.status.displayClock || '';\n\n  const current = { awayScore, homeScore };\n  const prev = lastScores[id];\n\n  if (prev && (prev.awayScore !== awayScore || prev.homeScore !== homeScore)) {\n    const scorer = awayScore > prev.awayScore ? away.team.displayName : home.team.displayName;\n    const points = Math.abs((awayScore + homeScore) - (prev.awayScore + prev.homeScore));\n    sendAlert(`**${away.team.displayName} ${awayScore}-${homeScore} ${home.team.displayName}** (${quarter}${clock ? ` ${clock}` : ''}) â€“ ${scorer} scores ${points} pts! ðŸˆ`);\n  }\n\n  lastScores[id] = current;\n}\n\nasync function poll() {\n  console.log('Polling Super Bowl...');\n  const data = await fetchScoreboard();\n  if (data?.events) {\n    const superBowl = data.events.find(e => e.name.toLowerCase().includes('super bowl') || e.name.toLowerCase().includes('lx'));\n    if (superBowl) checkChanges(superBowl);\n    else console.log('No Super Bowl found');\n  }\n}\n\nsetInterval(poll, 10000); // 10s\npoll(); // Initial\n\n// Simple HTTP server for health\nhttp.createServer((req, res) => {\n  if (req.url === '/health') {\n    res.end(JSON.stringify({status: 'ok', lastPoll: new Date().toISOString() }));\n  } else if (req.url === '/scores') {\n    res.end(JSON.stringify(lastScores));\n  } else {\n    res.statusCode = 404;\n    res.end();\n  }\n}).listen(3000, () => console.log('NFL Alerts on 3000'));\n\nprocess.on('SIGINT', () => process.exit());