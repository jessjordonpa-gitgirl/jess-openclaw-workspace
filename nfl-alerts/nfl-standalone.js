const http = require('http');\nconst { spawn } = require('child_process');\n\nlet lastScores = {};\nconst CHAT_ID = '468765386';\nconst TARGET_GAME = /super.*bowl|lx/i;\nlet gameEnded = false;\n\nasync function fetchScoreboard() {\n  return new Promise((resolve, reject) => {\n    const req = http.request({\n      host: 'site.api.espn.com',\n      path: '/apis/site/v2/sports/football/nfl/scoreboard?seasontype=3&dates=20260209',\n      method: 'GET',\n      headers: {'User-Agent': 'Mozilla/5.0'}\n    }, res => {\n      let data = '';\n      res.on('data', chunk => data += chunk);\n      res.on('end', () => resolve(JSON.parse(data)));\n    });\n    req.on('error', reject);\n    req.end();\n  });\n}\n\nfunction sendAlert(message) {\n  const cmd = spawn('openclaw', ['message', 'action=send', 'channel=telegram', 'target=' + CHAT_ID, 'message=' + message]);\n  cmd.on('close', code => console.log('Alert:', code ? 'failed' : 'sent', message));\n}\n\nfunction checkChanges(event) {\n  if (gameEnded || event.status.type.state !== 'in') {\n    if (lastScores[event.id] && event.status.type.state !== 'in') {\n      const comp = event.competitions[0];\n      const away = comp.competitors[1];\n      const home = comp.competitors[0];\n      sendAlert(`**${TARGET_GAME} FINAL:** ${away.team.displayName} ${away.score || 0} - ${home.team.displayName} ${home.score || 0} ðŸˆ`);\n      gameEnded = true;\n    }\n    return;\n  }\n\n  const id = event.id;\n  const comp = event.competitions[0];\n  const away = comp.competitors[1];\n  const home = comp.competitors[0];\n  const awayScore = parseInt(away.score || '0');\n  const homeScore = parseInt(home.score || '0');\n  const quarter = event.status.type.shortDetail;\n  const clock = event.status.displayClock;\n\n  const current = {awayScore, homeScore};\n  const prev = lastScores[id];\n\n  if (prev && (prev.awayScore !== awayScore || prev.homeScore !== homeScore)) {\n    const scorer = awayScore > prev.awayScore ? away.team.displayName : home.team.displayName;\n    const points = Math.abs((awayScore + homeScore) - (prev.awayScore + prev.homeScore));\n    sendAlert(`**${away.team.displayName} ${awayScore}-${homeScore} ${home.team.displayName}** (${quarter} ${clock}) â€“ ${scorer} +${points} pts! ðŸˆ`);\n  }\n  lastScores[id] = current;\n}\n\nasync function poll() {\n  console.log('Poll:', new Date().toISOString());\n  try {\n    const data = await fetchScoreboard();\n    const superBowl = data.events.find(e => TARGET_GAME.test(e.name));\n    if (superBowl) checkChanges(superBowl);\n  } catch (e) {\n    console.error('Poll fail:', e.message);\n  }\n}\n\nsetInterval(poll, 10000);\npoll();\n\nhttp.createServer((req, res) => {\n  if (req.url === '/health') res.end('OK');\n  else res.statusCode = 404, res.end();\n}).listen(3000, () => console.log('Health on 3000'));\n\nprocess.on('SIGINT', () => process.exit());